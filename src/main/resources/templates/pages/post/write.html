<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{common/layouts/defaultLayout}">



<th:block layout:fragment="Content">
    <style>
        .ck-editor__editable_inline {
            min-height: 50vh;
        }
    </style>
    <form id="postForm" method="post" class="flex flex-col gap-4 h-full">
            <input type="text" name="title" placeholder="내용 입력" required  />
        <textarea id="editor" class="flex-1" placeholder="내용 입력"></textarea>
        <div class="flex gap-4">
            <button type="button" class="text-white bg-blue-500 hover:bg-blue-600 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800">등록</button>
            <button type="button" class="text-white bg-green-500 hover:bg-green-600 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800">저장</button>
        </div>
    </form>

    <script src="https://cdn.ckeditor.com/ckeditor5/39.0.1/classic/ckeditor.js"></script>
    <script th:src="@{/js/UploadAdapter.js}"> </script>

    <script>
         ClassicEditor
            .create(document.querySelector('#editor'), {
                extraPlugins: [uploadAdapterPlugin]
            })
             .then(editor => {
                 window.editorInstance = editor;


             })
             .catch(console.error);

         // 폼 제출 처리
         document.getElementById('postForm').addEventListener('submit', function (e) {
             e.preventDefault();

             const formData = {
                 title: this.title.value,
                 content: editorInstance.getData()
             };

             fetch('/posts', {
                 method: 'POST',
                 headers: {
                     'Content-Type': 'application/json'
                 },
                 body: JSON.stringify(formData)
             })
             .then(response => {
                 if (response.ok) {
                     alert('게시글이 등록되었습니다.');
                     window.location.href = '/posts'; // 목록으로 이동
                 } else {
                     alert('등록 실패');
                 }
             });
         });
    </script>
</th:block>
